#!/usr/bin/env sh
. "$(dirname -- "$0")/_"

echo ""
echo "ğŸ” Running pre-commit checks..."
echo ""

# Change to Aura.Web directory for npm commands
cd Aura.Web || exit 1

# Step 1: Run lint-staged to lint and format only staged files
echo "ğŸ“ Linting and formatting staged files..."
npx lint-staged

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Commit rejected: Linting or formatting failed"
  echo ""
  echo "Please fix the linting errors above before committing."
  echo "To bypass this check, use: git commit --no-verify"
  echo ""
  exit 1
fi

# Step 2: Scan for placeholder markers
echo ""
echo "ğŸ” Scanning for placeholder markers..."
cd .. || exit 1
node scripts/audit/find-placeholders.js

if [ $? -ne 0 ]; then
  echo ""
  echo "âŒ Commit rejected: Placeholder markers found in code"
  echo ""
  echo "Please remove TODO/FIXME/HACK comments before committing."
  echo "To bypass this check, use: git commit --no-verify"
  echo ""
  exit 1
fi

# Step 3: Run quick type check (TypeScript only, fast)
# Temporarily disabled due to pre-existing type errors in codebase
# echo ""
# echo "ğŸ”§ Running TypeScript type check..."
# cd Aura.Web || exit 1
# npm run type-check

# if [ $? -ne 0 ]; then
#   echo ""
#   echo "âŒ Commit rejected: TypeScript type errors found"
#   echo ""
#   echo "Please fix the type errors above before committing."
#   echo "To bypass this check, use: git commit --no-verify"
#   echo ""
#   exit 1
# fi

echo ""
echo "âœ… All pre-commit checks passed (type check skipped)"
echo ""
exit 0
