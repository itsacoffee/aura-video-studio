<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="apple-touch-icon" sizes="256x256" href="/logo256.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/logo512.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
    <!-- Content Security Policy: Restrict script sources for XSS protection -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: https:; font-src 'self' data:; connect-src 'self' http://localhost:* http://127.0.0.1:* ws://localhost:* ws://127.0.0.1:*; media-src 'self' blob:; worker-src 'self' blob:; frame-src 'none';"
    />
    <!-- Windows 11 Snap Layouts Support -->
    <meta name="msapplication-TileColor" content="#0ea5e9" />
    <meta name="theme-color" content="#0ea5e9" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
    <title>Aura Video Studio</title>
    <style>
      /* Initialization guard styles - shown only if JS fails to load */
      #init-guard {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f5f5f5;
        z-index: 10000;
        padding: 40px;
        box-sizing: border-box;
      }
      #init-guard .container {
        max-width: 700px;
        margin: 100px auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-left: 4px solid #d32f2f;
      }
      #init-guard h1 {
        color: #d32f2f;
        margin-top: 0;
      }
      #init-guard code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Consolas', monospace;
      }
      #init-guard ul {
        line-height: 1.8;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <div id="init-guard">
      <div class="container">
        <h1>⚠️ Application Failed to Initialize</h1>
        <p>The Aura Video Studio application did not load within the expected time. This usually indicates a problem with the JavaScript bundle or browser compatibility.</p>
        
        <h2>Troubleshooting Steps:</h2>
        <ul>
          <li><strong>1. Open DevTools:</strong> Press <code>F12</code> or <code>Ctrl+Shift+I</code></li>
          <li><strong>2. Check Console Tab:</strong> Look for red error messages indicating what failed</li>
          <li><strong>3. Check Network Tab:</strong> Ensure all JavaScript files loaded successfully (status 200)</li>
          <li><strong>4. Common Issues:</strong>
            <ul>
              <li>Content Security Policy (CSP) blocking scripts</li>
              <li>Missing or corrupted JavaScript files</li>
              <li>Browser extensions blocking resources</li>
              <li>Incompatible browser version</li>
            </ul>
          </li>
          <li><strong>5. Try These Fixes:</strong>
            <ul>
              <li>Hard refresh: <code>Ctrl+F5</code> or <code>Ctrl+Shift+R</code></li>
              <li>Clear browser cache: <code>Ctrl+Shift+Delete</code></li>
              <li>Disable browser extensions and try again</li>
              <li>Try a different browser (Chrome, Edge, Firefox)</li>
            </ul>
          </li>
          <li><strong>6. Still Having Issues?</strong>
            <ul>
              <li>Visit <a href="/diag">/diag</a> for diagnostic information</li>
              <li>Visit <a href="/api/healthz">/api/healthz</a> to verify API is running</li>
              <li>Check server logs for errors</li>
            </ul>
          </li>
        </ul>
        
        <p><small>If you continue to experience problems, please report this issue with the Console errors and Network tab details.</small></p>
      </div>
    </div>
    <script>
      // Show initialization guard after 10 seconds if app hasn't hydrated
      // The main app will clear this timer once React initializes successfully
      window.__initTimeout = setTimeout(function() {
        // Check if root element has been hydrated
        var root = document.getElementById('root');
        if (!root || root.children.length === 0) {
          document.getElementById('init-guard').style.display = 'block';
          console.error('[Init Guard] Application failed to initialize within timeout');
        }
      }, 10000);
      
      // Also detect script load failures
      window.addEventListener('error', function(e) {
        if (e.target && (e.target.tagName === 'SCRIPT' || e.target.tagName === 'LINK')) {
          console.error('[Init Guard] Failed to load resource:', e.target.src || e.target.href);
          // Show guard immediately on critical resource failure
          setTimeout(function() {
            var root = document.getElementById('root');
            if (!root || root.children.length === 0) {
              document.getElementById('init-guard').style.display = 'block';
            }
          }, 2000);
        }
      }, true);
    </script>
    <!-- Development: Vite transforms this to /assets/index-[hash].js during production build -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
